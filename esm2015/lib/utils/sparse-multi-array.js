export class SparseMultiArrayImpl {
    constructor(maxDim, ctor) {
        this._impl = [];
        this._maxDim = maxDim;
        this._factory = ctor;
    }
    getElement(...numbers) {
        const len = this._maxDim > numbers.length ? this._maxDim : numbers.length;
        let data = this._impl;
        for (let i = 0; i < len; i++) {
            const dimIndex = numbers[i] || 0;
            if (data[dimIndex]) {
                data = data[dimIndex];
            }
            else {
                return this._factory();
            }
        }
        return data;
    }
    setElement(val, ...numbers) {
        const len = this._maxDim > numbers.length ? this._maxDim : numbers.length;
        let data = this._impl;
        for (let i = 0; i < len - 1; i++) {
            const dimIndex = numbers[i] || 0;
            if (!data[dimIndex]) {
                data[dimIndex] = [];
            }
            data = data[dimIndex];
        }
        // Unroll the last one
        const lastIndex = numbers[len - 1] || 0;
        data[lastIndex] = val;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BhcnNlLW11bHRpLWFycmF5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvbHB3YXJlL25neC13aXphcmQvIiwic291cmNlcyI6WyJsaWIvdXRpbHMvc3BhcnNlLW11bHRpLWFycmF5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU1BLE1BQU0sT0FBTyxvQkFBb0I7SUFNN0IsWUFBWSxNQUFjLEVBQUUsSUFBYTtRQUNyQyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNoQixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztRQUN0QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztJQUN6QixDQUFDO0lBRUQsVUFBVSxDQUFDLEdBQUcsT0FBaUI7UUFDM0IsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO1FBQzFFLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDdEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUMxQixNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2pDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUNoQixJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ3pCO2lCQUFNO2dCQUNILE9BQU8sSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO2FBQzFCO1NBQ0o7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRUQsVUFBVSxDQUFDLEdBQU0sRUFBRSxHQUFHLE9BQWlCO1FBQ25DLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztRQUMxRSxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ3RCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzlCLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRTtnQkFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQzthQUN2QjtZQUNELElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDekI7UUFFRCxzQkFBc0I7UUFDdEIsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztJQUMxQixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgaW50ZXJmYWNlIElTcGFyc2VNdWx0aUFycmF5PFQ+IHtcclxuICAgIGdldEVsZW1lbnQoLi4ubnVtYmVyczogbnVtYmVyW10pOiBUO1xyXG4gICAgc2V0RWxlbWVudCh2YWw6IFQsIC4uLm51bWJlcnM6IG51bWJlcltdKTogdm9pZDtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBTcGFyc2VNdWx0aUFycmF5SW1wbDxUPiB7XHJcblxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBfaW1wbDogYW55O1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSBfbWF4RGltOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9mYWN0b3J5OiAoKSA9PiBUO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1heERpbTogbnVtYmVyLCBjdG9yOiAoKSA9PiBUKSB7XHJcbiAgICAgICAgdGhpcy5faW1wbCA9IFtdO1xyXG4gICAgICAgIHRoaXMuX21heERpbSA9IG1heERpbTtcclxuICAgICAgICB0aGlzLl9mYWN0b3J5ID0gY3RvcjtcclxuICAgIH1cclxuXHJcbiAgICBnZXRFbGVtZW50KC4uLm51bWJlcnM6IG51bWJlcltdKTogVCB7XHJcbiAgICAgICAgY29uc3QgbGVuID0gdGhpcy5fbWF4RGltID4gbnVtYmVycy5sZW5ndGggPyB0aGlzLl9tYXhEaW0gOiBudW1iZXJzLmxlbmd0aDtcclxuICAgICAgICBsZXQgZGF0YSA9IHRoaXMuX2ltcGw7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBkaW1JbmRleCA9IG51bWJlcnNbaV0gfHwgMDtcclxuICAgICAgICAgICAgaWYgKGRhdGFbZGltSW5kZXhdKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YVtkaW1JbmRleF07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZmFjdG9yeSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEVsZW1lbnQodmFsOiBULCAuLi5udW1iZXJzOiBudW1iZXJbXSkge1xyXG4gICAgICAgIGNvbnN0IGxlbiA9IHRoaXMuX21heERpbSA+IG51bWJlcnMubGVuZ3RoID8gdGhpcy5fbWF4RGltIDogbnVtYmVycy5sZW5ndGg7XHJcbiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLl9pbXBsO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuIC0gMTsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGRpbUluZGV4ID0gbnVtYmVyc1tpXSB8fCAwO1xyXG4gICAgICAgICAgICBpZiAoIWRhdGFbZGltSW5kZXhdKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhW2RpbUluZGV4XSA9IFtdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRhdGEgPSBkYXRhW2RpbUluZGV4XTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFVucm9sbCB0aGUgbGFzdCBvbmVcclxuICAgICAgICBjb25zdCBsYXN0SW5kZXggPSBudW1iZXJzW2xlbiAtIDFdIHx8IDA7XHJcbiAgICAgICAgZGF0YVtsYXN0SW5kZXhdID0gdmFsO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==